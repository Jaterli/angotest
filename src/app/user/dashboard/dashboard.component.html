<div class="container mx-auto p-4 md:p-6 lg:p-8">
  
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">Mi Dashboard</h1>
      <p class="text-gray-600 dark:text-gray-400 mt-2">
        {{ currentUser?.first_name || currentUser?.username }}, 
        aqu√≠ puedes ver tu progreso y compararte con otros usuarios
      </p>
      @if (dashboardData() && lastUpdated()) {
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Actualizado {{ lastUpdated() }}
        </p>
      }
    </div>

    <!-- Bot√≥n para refrescar -->
    <button (click)="refreshAllData()"
            [disabled]="loading()"
            class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg text-white bg-blue-600 dark:bg-blue-700 hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
      <svg [class]="loading() ? 'animate-spin' : ''" 
           class="w-4 h-4 mr-2" 
           fill="currentColor" 
           viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566a1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566a1 1 0 01.61-1.276z" clip-rule="evenodd"/>
      </svg>
      {{ loading() ? 'Actualizando...' : 'Actualizar Datos' }}
    </button>
  </div>

  <!-- Estado de carga -->
  @if (loading() && !dashboardData()) {
    <div class="flex flex-col items-center justify-center min-h-[400px] space-y-4">
      <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
      <p class="text-gray-600 dark:text-gray-400 text-lg">Cargando dashboard...</p>
    </div>
  }

  <!-- Contenido principal -->
  @if (dashboardData() && !loading()) {    
    <!-- Secci√≥n: Resumen General -->
    <div class="mb-12">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Resumen General</h2>
        <div class="flex items-center gap-2">
          <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
          <span class="text-sm text-gray-500 dark:text-gray-400">
            Puntuaci√≥n de eficiencia: {{ timeStats().efficiency_score_all_attempts }}%, {{ timeStats().efficiency_score_first_attempt }}% primero
          </span>
        </div>
      </div>

      <!-- Estad√≠sticas principales en 2x2 -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        
        <!-- Tests y Estado -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-700">
          <div class="flex items-center mb-4">
            <div class="p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg mr-4">
              <svg class="w-6 h-6 text-emerald-600 dark:text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
            </div>
            <div class="flex-1">
              <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
                {{ personalStats()!.completed_tests_all_attempts }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Tests completados</div>
            </div>
            <div class="text-right">
              <div class="text-lg font-semibold text-blue-600 dark:text-blue-400">
                {{ personalStats()!.completed_tests_first_attempt }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Primer intento</div>
            </div>
          </div>
          
          <div class="grid grid-cols-3 gap-2">

            <div class="text-center p-2 bg-gray-50 dark:bg-gray-900/50 rounded">
              <div class="text-lg font-semibold text-blue-600 dark:text-blue-400">
                {{ personalStats()!.in_progress_tests }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">En progreso</div>
            </div>
            <div class="text-center p-2 bg-gray-50 dark:bg-gray-900/50 rounded">
              <div class="text-lg font-semibold text-amber-600 dark:text-amber-400">
                {{ personalStats()!.abandoned_tests }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Abandonados</div>
            </div>
            <div class="text-center p-2 bg-gray-50 dark:bg-gray-900/50 rounded">
              <div class="text-lg font-semibold text-gray-700 dark:text-gray-300">
                {{ totalTests() }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Iniciados</div>
            </div>
          </div>
        </div>

        <!-- Puntuaci√≥n -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-700">
          <div class="flex items-center mb-4">
            <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg mr-4">
              <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
              </svg>
            </div>
            <div>
              <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
                {{ personalStats()!.average_score_all_attempts | number:'1.0-2' }}%
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Puntuaci√≥n promedio</div>
            </div>
          </div>
          <div class="space-y-2">
            <div class="flex justify-between items-center text-sm">
              <span class="text-gray-600 dark:text-gray-400">Primer intento:</span>
              <span class="font-medium text-emerald-600 dark:text-emerald-400">
                {{ personalStats()!.average_score_first_attempt | number:'1.0-2' }}%
              </span>
            </div>
            <div class="flex justify-between items-center text-sm">
              <span class="text-gray-600 dark:text-gray-400">Mejora:</span>
              <span class="font-medium" [class]="getImprovementColor(improvementStats().accuracy_improvement, true)">
                {{ getImprovementSymbol(improvementStats().accuracy_improvement, 'accuracy') }}
                {{ abs(improvementStats().accuracy_improvement).toFixed(2) }}%
              </span>
            </div>
          </div>
        </div>

        <!-- Tiempos -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-700">
          <div class="flex items-center mb-4">
            <div class="p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg mr-4">
              <svg class="w-6 h-6 text-amber-600 dark:text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
              </svg>
            </div>
            <div>
              <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
                {{ formatTimeShort(personalStats()!.average_time_taken_per_question_all_attempts) }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Tiempo/pregunta</div>
            </div>
          </div>
          <div class="space-y-2">
            <div class="flex justify-between items-center text-sm">
              <span class="text-gray-600 dark:text-gray-400">Primer intento:</span>
              <span class="font-medium text-emerald-600 dark:text-emerald-400">
                {{ formatTimeShort(personalStats()!.average_time_taken_per_question_first_attempt) }}
              </span>
            </div>
            <div class="flex justify-between items-center text-sm">
              <span class="text-gray-600 dark:text-gray-400">Mejora:</span>
              <span class="font-medium" [class]="getImprovementColor(improvementStats().time_improvement, false)">
                {{ getImprovementSymbol(improvementStats().time_improvement, 'time') }}
                {{ abs(improvementStats().time_improvement).toFixed(1) }}s
              </span>
            </div>
          </div>
        </div>

      <!-- Respuestas -->
      <div class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center">
            <div class="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg mr-4">
              <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
            </div>
            <div>
              <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
                {{ personalStats()!.total_correct?.all_attempts || 0 }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Respuestas correctas</div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm text-gray-500 dark:text-gray-400">Primer intento</div>
            <div class="text-lg font-bold text-emerald-600 dark:text-emerald-400">
              {{ personalStats()!.total_correct?.first_attempt || 0 }}
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4 mb-4">
          <!-- Precisi√≥n -->
          <div class="bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-3">
            <div class="flex justify-between items-center mb-1">
              <span class="text-xs text-gray-600 dark:text-gray-400">Precisi√≥n</span>
              <span class="text-xs font-medium text-emerald-600 dark:text-emerald-400">
                {{ personalStats()!.average_score_all_attempts | number:'1.0-2' }}%
              </span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
              <div class="bg-emerald-500 h-1.5 rounded-full" 
                  [style.width.%]="personalStats()!.average_score_all_attempts"></div>
            </div>
            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              {{ personalStats()!.average_score_first_attempt | number:'1.0-2' }}% primero
            </div>
          </div>
          
          <!-- Total preguntas -->
          <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
            <div class="flex justify-between items-center mb-1">
              <span class="text-xs text-gray-600 dark:text-gray-400">Preguntas</span>
              <span class="text-xs font-medium text-blue-600 dark:text-blue-400">
                {{ personalStats()!.total_questions_all_attempts }}
              </span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
              <div class="bg-blue-500 h-1.5 rounded-full" 
                  [style.width.%]="personalStats()!.total_questions_first_attempt > 0 ? 
                  (personalStats()!.total_questions_first_attempt / personalStats()!.total_questions_all_attempts) * 100 : 0"></div>
            </div>
            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
              {{ personalStats()!.total_questions_first_attempt }} primero
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-3">
          <!-- Respuestas correctas detalladas -->
          <div class="text-center p-2 bg-emerald-50 dark:bg-emerald-900/20 rounded">
            <div class="text-sm font-semibold text-emerald-700 dark:text-emerald-400">
              {{ personalStats()!.total_correct?.all_attempts || 0 }}
            </div>
            <div class="text-xs text-gray-500 dark:text-gray-400">
              Correctas
              <span class="block text-emerald-600 dark:text-emerald-400 font-medium">
                {{ personalStats()!.total_correct?.first_attempt || 0 }} primero
              </span>
            </div>
          </div>
          
          <!-- Respuestas incorrectas detalladas -->
          <div class="text-center p-2 bg-red-50 dark:bg-red-900/20 rounded">
            <div class="text-sm font-semibold text-red-700 dark:text-red-400">
              {{ personalStats()!.total_wrong?.all_attempts || 0 }}
            </div>
            <div class="text-xs text-gray-500 dark:text-gray-400">
              Incorrectas
              <span class="block text-red-600 dark:text-red-400 font-medium">
                {{ personalStats()!.total_wrong?.first_attempt || 0 }} primero
              </span>
            </div>
          </div>
        </div>
        
        <!-- Eficiencia de primer intento -->
        <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <div class="flex justify-between items-center">
            <span class="text-xs text-gray-600 dark:text-gray-400">Eficiencia primer intento:</span>
            <span class="text-xs font-medium text-emerald-600 dark:text-emerald-400">
              {{ personalStats()!.total_questions_first_attempt > 0 ? 
                ((personalStats()!.total_correct?.first_attempt || 0) / personalStats()!.total_questions_first_attempt * 100).toFixed(1) : 0 }}%
            </span>
          </div>
          <div class="flex justify-between items-center mt-1">
            <span class="text-xs text-gray-600 dark:text-gray-400">Respuestas adicionales:</span>
            <span class="text-xs font-medium text-blue-600 dark:text-blue-400">
              {{ (personalStats()!.total_questions_all_attempts - personalStats()!.total_questions_first_attempt) }} 
              (+{{ personalStats()!.total_questions_all_attempts > 0 ? 
                  ((personalStats()!.total_questions_all_attempts - personalStats()!.total_questions_first_attempt) / personalStats()!.total_questions_all_attempts * 100).toFixed(0) : 0 }}%)
            </span>
          </div>
        </div>
      </div>
              
      </div>

      <!-- Estad√≠sticas detalladas en 2 columnas -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        
        <!-- Actividad Resumida -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Resumen de Actividad</h3>
          <div class="space-y-4">
            <div>
              <div class="flex justify-between items-center mb-1">
                <span class="text-gray-600 dark:text-gray-400">Tasa de finalizaci√≥n:</span>
                <span class="font-bold text-emerald-600 dark:text-emerald-400">{{ completionPercentage() | number:'1.0-2' }}%</span>
              </div>
              <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                <div class="bg-emerald-500 h-2 rounded-full" 
                    [style.width.%]="completionPercentage()"></div>
              </div>
            </div>
            
            <div class="grid grid-cols-3 gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
              <div class="text-center">
                <div class="text-xl font-bold text-blue-600 dark:text-blue-400">{{ personalStats()!.total_questions_answered_all_attempts }}</div>
                <div class="text-xs text-gray-500 dark:text-gray-400">Total preguntas</div>
              </div>
              <div class="text-center">
                <div class="text-xl font-bold text-emerald-600 dark:text-emerald-400">{{ personalStats()!.total_questions_first_attempt }}</div>
                <div class="text-xs text-gray-500 dark:text-gray-400">Primer intento</div>
              </div>
              <div class="text-center">
                <div class="text-xl font-bold text-purple-600 dark:text-purple-400">{{ improvementStats().questions_improvement }}</div>
                <div class="text-xs text-gray-500 dark:text-gray-400">Preguntas extras</div>
              </div>
            </div>

            <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
              <div class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                Distribuci√≥n de respuestas:
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-sm text-gray-600 dark:text-gray-400">Primer intento:</span>
                    <span class="text-sm font-medium">
                      {{ personalStats()!.total_correct.first_attempt || 0 }}/{{ personalStats()!.total_questions_first_attempt }}
                    </span>
                  </div>
                  <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
                    <div class="bg-emerald-500 h-1.5 rounded-full" 
                        [style.width.%]="personalStats()!.total_questions_first_attempt > 0 ? 
                        ((personalStats()!.total_correct.first_attempt || 0) / personalStats()!.total_questions_first_attempt) * 100 : 0">
                    </div>
                  </div>
                </div>
                <div>
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-sm text-gray-600 dark:text-gray-400">Todos los intentos:</span>
                    <span class="text-sm font-medium">
                      {{ personalStats()!.total_correct.all_attempts || 0 }}/{{ personalStats()!.total_questions_answered_all_attempts }}
                    </span>
                  </div>
                  <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
                    <div class="bg-blue-500 h-1.5 rounded-full" 
                        [style.width.%]="personalStats()!.total_questions_answered_all_attempts > 0 ? 
                        ((personalStats()!.total_correct.all_attempts || 0) / personalStats()!.total_questions_answered_all_attempts) * 100 : 0">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tiempos Totales y Mejoras -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Inversi√≥n de Tiempo y Mejoras</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                <span class="text-gray-700 dark:text-gray-300">Total invertido:</span>
              </div>
              <span class="font-bold text-gray-900 dark:text-gray-100">
                {{ formatTime(personalStats()!.total_time_taken_all_attempts) }}
              </span>
            </div>
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-3 h-3 bg-emerald-500 rounded-full mr-3"></div>
                <span class="text-gray-700 dark:text-gray-300">Solo primer intento:</span>
              </div>
              <span class="font-bold text-gray-900 dark:text-gray-100">
                {{ formatTime(personalStats()!.total_time_taken_first_attempt) }}
              </span>
            </div>
            
            <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
              <div class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                Eficiencia entre intentos:
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div class="text-center p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg">
                  <div class="text-lg font-bold text-emerald-600 dark:text-emerald-400">
                    {{ abs(improvementStats().time_improvement).toFixed(1) }}s
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">Mejora en tiempo</div>
                </div>
                <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                  <div class="text-lg font-bold text-blue-600 dark:text-blue-400">
                    {{ abs(improvementStats().accuracy_improvement).toFixed(2) }}%
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">Mejora en precisi√≥n</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secci√≥n: Distribuci√≥n por Niveles -->
    @if (levelDistribution().length > 0) {
    <div class="mb-12">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6">Distribuci√≥n por Niveles</h2>
      
      <!-- Tarjetas de resumen por nivel -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        @for (distribution of levelDistribution(); track distribution.level; let i = $index) {
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
          <!-- Encabezado con nivel y estad√≠sticas principales -->
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-lg flex items-center justify-center mr-4" 
                  [style.backgroundColor]="getLevelColor(distribution.level) + '20'">
                <span class="text-xl">{{ getLevelIcon(distribution.level) }}</span>
              </div>
              <div>
                <h3 class="font-semibold text-gray-900 dark:text-gray-100">{{ distribution.level }}</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  {{ distribution.tests }} tests ({{ distribution.percentage | number:'1.0-2' }}%)
                </p>
              </div>
            </div>
            <!-- M√©tricas clave resumidas -->
            <div class="text-right">
              <div class="text-lg font-bold" [style.color]="getLevelColor(distribution.level)">
                {{ distribution.accuracy_all_attempts | number:'1.0-2' }}%
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Precisi√≥n total</div>
            </div>
          </div>
          
          <!-- Barra de progreso -->
          <div class="mb-6">
            <div class="flex justify-between text-sm mb-1">
              <span>Progreso de tests</span>
              <span class="font-medium" [style.color]="getLevelColor(distribution.level)">
                {{ distribution.percentage | number:'1.0-2' }}%
              </span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
              <div class="h-2 rounded-full" 
                  [style.backgroundColor]="getLevelColor(distribution.level)"
                  [style.width.%]="distribution.percentage"></div>
            </div>
          </div>
          
          <!-- Grid de m√©tricas principales -->
          <div class="grid grid-cols-2 gap-3 mb-6">
            <!-- Tiempo por pregunta -->
            <div class="bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3">
              <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Tiempo/pregunta</div>
              <div class="text-sm font-medium" [style.color]="getLevelColor(distribution.level)">
                {{ formatTimeShort(distribution.time_taken_all_attempts) }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                {{ formatTimeShort(distribution.time_taken_first_attempt) }} primero
              </div>
            </div>
            
            <!-- Preguntas respondidas -->
            <div class="bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3">
              <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Preguntas</div>
              <div class="text-sm font-medium" [style.color]="getLevelColor(distribution.level)">
                {{ distribution.total_questions_all_attempts }}
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                {{ distribution.total_questions_first_attempt }} primero
              </div>
            </div>
          </div>
          
          <!-- Estad√≠sticas de respuestas -->
          <div class="mb-6">
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">Distribuci√≥n de respuestas:</div>
            <div class="grid grid-cols-2 gap-3">
              <!-- Respuestas correctas -->
              <div class="bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-3">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-emerald-700 dark:text-emerald-400 font-medium">Correctas</div>
                    <div class="text-sm font-bold text-emerald-600 dark:text-emerald-400">
                      {{ distribution.total_correct_all_attempts }}
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="text-xs text-gray-500 dark:text-gray-400">{{ distribution.total_correct_first_attempt }} primero</div>
                    <div class="text-xs text-emerald-600 dark:text-emerald-400 font-medium">
                      {{ distribution.total_correct_all_attempts > 0 ? ((distribution.total_correct_first_attempt / distribution.total_correct_all_attempts) * 100).toFixed(0) : 0 }}%
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Respuestas incorrectas -->
              <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-3">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-xs text-red-700 dark:text-red-400 font-medium">Incorrectas</div>
                    <div class="text-sm font-bold text-red-600 dark:text-red-400">
                      {{ distribution.total_wrong_all_attempts }}
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="text-xs text-gray-500 dark:text-gray-400">{{ distribution.total_wrong_first_attempt }} primero</div>
                    <div class="text-xs text-red-600 dark:text-red-400 font-medium">
                      {{ distribution.total_wrong_all_attempts > 0 ? ((distribution.total_wrong_first_attempt / distribution.total_wrong_all_attempts) * 100).toFixed(0) : 0 }}%
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Mejoras con repetici√≥n -->
          <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-3">Mejoras con repetici√≥n:</div>
            <div class="grid grid-cols-2 gap-3">
              <!-- Mejora en precisi√≥n -->
              <div class="text-center">
                <div class="text-lg font-bold" 
                    [class]="distribution.accuracy_improvement >= 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-red-600 dark:text-red-400'">
                  {{ distribution.accuracy_improvement >= 0 ? '+' : '' }}{{ distribution.accuracy_improvement.toFixed(1) }}%
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  <div>Precisi√≥n</div>
                  <div class="text-xs">
                    {{ distribution.accuracy_first_attempt | number:'1.0-1' }}% ‚Üí {{ distribution.accuracy_all_attempts | number:'1.0-1' }}%
                  </div>
                </div>
              </div>
              
              <!-- Mejora en tiempo -->
              <div class="text-center">
                <div class="text-lg font-bold" 
                    [class]="distribution.time_taken_improvement >= 0 ? 'text-emerald-600 dark:text-emerald-400' : 'text-red-600 dark:text-red-400'">
                  {{ distribution.time_taken_improvement >= 0 ? '+' : '' }}{{ distribution.time_taken_improvement.toFixed(0) }}s
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  <div>Tiempo/preg</div>
                  <div class="text-xs">
                    {{ formatTimeShort(distribution.time_taken_first_attempt) }} ‚Üí {{ formatTimeShort(distribution.time_taken_all_attempts) }}
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Resumen de eficiencia -->
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
              <div class="flex justify-between items-center text-sm">
                <span class="text-gray-600 dark:text-gray-400">Tasa de acierto:</span>
                <span class="font-medium" [style.color]="getLevelColor(distribution.level)">
                  {{ distribution.total_questions_all_attempts > 0 ? ((distribution.total_correct_all_attempts / distribution.total_questions_all_attempts) * 100).toFixed(1) : 0 }}%
                </span>
              </div>
              <div class="flex justify-between items-center text-sm mt-1">
                <span class="text-gray-600 dark:text-gray-400">Aciertos primer intento:</span>
                <span class="font-medium text-emerald-600 dark:text-emerald-400">
                  {{ distribution.total_questions_first_attempt > 0 ? 
                    ((distribution.total_correct_first_attempt / distribution.total_questions_first_attempt) * 100).toFixed(1) : 0 }}%
                </span>
              </div>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
    }

    <!-- Secci√≥n: Comparaci√≥n con la Comunidad (Opcional) -->
    @if (!showCommunityComparison()) {
    <div class="mb-12">
      <div class="bg-white dark:bg-gray-800 rounded-xl p-8 text-center shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="w-20 h-20 text-blue-300 dark:text-blue-600 mx-auto mb-4">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clip-rule="evenodd"/>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3">Compara tu rendimiento</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto">
          Descubre c√≥mo te comparas con otros {{ totalActiveUsers() }} usuarios activos en la comunidad. 
          Verifica tu posici√≥n en los rankings y analiza tu rendimiento frente al promedio.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <button (click)="loadCommunityComparison()"
                  [disabled]="rankingsLoading()"
                  class="inline-flex items-center justify-center px-6 py-3 text-base font-medium rounded-lg text-white bg-blue-600 dark:bg-blue-700 hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            <svg [class]="rankingsLoading() ? 'animate-spin' : ''" 
                  class="w-5 h-5 mr-2" 
                  fill="currentColor" 
                  viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
            {{ rankingsLoading() ? 'Cargando...' : 'Ver Comparativa' }}
          </button>
        </div>
      </div>
    </div>
    }

    <!-- Secci√≥n: Posici√≥n en la Comunidad y Rankings -->
    @if (showCommunityComparison() && rankingsData()) {
    <div class="mb-12">


      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Tu Posici√≥n y Rankings en la Comunidad</h2>
        <button (click)="hideCommunityComparison()"
                class="text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
          Ocultar
        </button>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Tarjetas de posici√≥n -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">üìä Tu Posici√≥n Global</h3>
          
          <div class="grid grid-cols-2 gap-4 mb-6">
            @for (position of rankingPositions(); track position.category; let i = $index) {
            @if (i < 4) {
            <div class="bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ position.category }}</span>
                <div class="text-xs px-2 py-1 bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300 rounded-full">
                  {{ totalActiveUsers() }} usuarios
                </div>
              </div>
              
              <div class="flex items-end justify-between">
                <div>
                  <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
                    #{{ position.position }}
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">Posici√≥n</div>
                </div>
                <div class="text-right">
                  <div class="text-sm font-medium" [class]="getPercentileColor(position.percentile)">
                    Top {{ position.percentile }}%
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">Percentil</div>
                </div>
              </div>
            </div>
            }
            }
          </div>
          
          <!-- Tu valor actual destacado -->
          <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
            <div class="text-sm text-gray-500 dark:text-gray-400 mb-3">Tus estad√≠sticas destacadas:</div>
            <div class="grid grid-cols-2 gap-3">
              <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">Tests Completados</div>
                <div class="text-lg font-bold text-blue-600 dark:text-blue-400">
                  {{ personalStats()?.completed_tests_first_attempt ?? 0 }}
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                  Posici√≥n #{{ currentUserPosition()?.completed_tests?? '-' }}
                </div>
              </div>
              <div class="bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-3">
                <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">Precisi√≥n General</div>
                <div class="text-lg font-bold text-emerald-600 dark:text-emerald-400">
                  {{ (personalStats()?.average_score_all_attempts ?? 0).toFixed(1) }}%
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                  Posici√≥n #{{ currentUserPosition()?.accuracy_all_attempts ?? '-' }}
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Rankings top 5 -->
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">üèÜ Top 5 por {{ getRankingTabLabel(activeRankingTab()) }}</h3>
            <div class="text-xs px-3 py-1 bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-300 rounded-full">
              +{{ rankingsData()?.min_tests_for_ranking }} tests
            </div>
          </div>
          
          <!-- Tabs de rankings -->
          <div class="mb-4">
            <div class="flex flex-wrap gap-2">
              @for (tab of ['tests', 'accuracy_all', 'time_all', 'questions']; track tab) {
              <button (click)="setRankingTab(tab)"
                      [class]="activeRankingTab() === tab 
                      ? 'px-3 py-1.5 text-xs font-medium rounded-full border' 
                      : 'px-3 py-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-gray-100 dark:bg-gray-900/50 hover:bg-gray-200 dark:hover:bg-gray-900/70 rounded-full transition-colors'"
                      [style.borderColor]="activeRankingTab() === tab ? getPositionColor(getRankingTabLabel(tab)) : 'transparent'"
                      [style.color]="activeRankingTab() === tab ? getPositionColor(getRankingTabLabel(tab)) : ''">
                {{ getRankingTabLabel(tab).split(' ')[0] }}
              </button>
              }
            </div>
          </div>
          
          <!-- Lista de top 5 -->
          <div class="space-y-3">
            @for (item of currentRankings(); track item.user_id; let i = $index) {
            <div [class]="getRankingItemClass(i, item.user_id)" class="rounded-lg p-3 transition-colors">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3"
                      [ngClass]="{
                        'bg-amber-100 dark:bg-amber-900/30': i === 0,
                        'bg-gray-100 dark:bg-gray-900/50': i === 1,
                        'bg-amber-50 dark:bg-amber-900/20': i === 2,
                        'bg-gray-50 dark:bg-gray-900/30': i > 2
                      }">
                    <span [ngClass]="{
                      'text-amber-600 dark:text-amber-400 font-bold': i === 0,
                      'text-gray-600 dark:text-gray-400 font-bold': i === 1,
                      'text-amber-500 dark:text-amber-300 font-bold': i === 2,
                      'text-gray-500 dark:text-gray-400': i > 2
                    }">
                      {{ item.rank }}
                    </span>
                  </div>
                  <div>
                    <div class="font-medium text-gray-900 dark:text-gray-100 text-sm">
                      {{ item.username }}
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">
                      Top {{ ((item.rank / totalActiveUsers()) * 100).toFixed(1) }}%
                    </div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-bold text-gray-900 dark:text-gray-100">
                    {{ formatRankingValue(item.value, getRankingTabLabel(activeRankingTab())) }}
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">
                    {{ getRankingTabLabel(activeRankingTab()).split('/')[0] }}
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
          
          <!-- Tu posici√≥n en este ranking -->
          <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mr-3">
                  <span class="text-blue-600 dark:text-blue-400 font-bold text-sm">
                    @switch(activeRankingTab()) {
                      @case ('tests') { #{{ currentUserPosition()!.completed_tests }} }
                      @case ('time_all') { #{{ currentUserPosition()!.avg_time_per_question_all_attempts }} }
                      @case ('time_first') { #{{ currentUserPosition()!.avg_time_per_question_first_attempt }} }
                      @case ('accuracy_all') { #{{ currentUserPosition()!.accuracy_all_attempts }} }
                      @case ('accuracy_first') { #{{ currentUserPosition()!.accuracy_first_attempt }} }
                      @case ('questions') { #{{ currentUserPosition()!.questions_answered }} }
                      @default { #- }
                    }
                  </span>
                </div>
                <div>
                  <div class="font-medium text-gray-900 dark:text-gray-100 text-sm">{{ currentUser?.username }}</div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">Tu posici√≥n</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-bold text-blue-600 dark:text-blue-400">
                  @switch(activeRankingTab()) {
                    @case ('tests') { 
                      {{ personalStats()?.completed_tests_first_attempt ?? 0 }} 
                    }
                    @case ('time_all') { 
                      {{ formatTimeShort(personalStats()?.average_time_taken_per_question_all_attempts ?? 0) }} 
                    }
                    @case ('time_first') { 
                      {{ formatTimeShort(personalStats()?.average_time_taken_per_question_first_attempt ?? 0) }} 
                    }
                    @case ('accuracy_all') { 
                      {{ (personalStats()?.average_score_all_attempts ?? 0).toFixed(1) }}% 
                    }
                    @case ('accuracy_first') { 
                      {{ (personalStats()?.average_score_first_attempt ?? 0).toFixed(1) }}% 
                    }
                    @case ('questions') { 
                      {{ personalStats()?.total_questions_answered_all_attempts ?? 0 }} 
                    }
                  }
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                  {{ getRankingTabLabel(activeRankingTab()).split('/')[0] }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Rankings por Nivel (si existen) -->
      @if (getLevelKeys().length > 0) {
      <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">üìà Rankings por Nivel</h3>
        
        <!-- Tabs de niveles -->
        <div class="mb-4">
          <div class="flex flex-wrap gap-2">
            @for (level of getLevelKeys(); track level) {
            <button (click)="setLevelRankingTab(level)"
                    [class]="activeLevelRankingTab() === level 
                    ? 'px-3 py-1.5 text-xs font-medium rounded-full border' 
                    : 'px-3 py-1.5 text-xs font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-gray-100 dark:bg-gray-900/50 hover:bg-gray-200 dark:hover:bg-gray-900/70 rounded-full transition-colors'"
                    [style.borderColor]="activeLevelRankingTab() === level ? getLevelColor(level) : 'transparent'"
                    [style.color]="activeLevelRankingTab() === level ? getLevelColor(level) : ''">
              {{ level }}
            </button>
            }
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Top 5 del nivel -->
          <div>
            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Top 5 - {{ activeLevelRankingTab() }}</h4>
            <div class="space-y-3">
              @for (item of currentLevelRankingsAccuracy(); track item.user_id; let i = $index) {
              <div [class]="getRankingItemClass(i, item.user_id)" class="rounded-lg p-3 transition-colors">
                <div class="flex items-center justify-between">
                  <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3"
                        [style.backgroundColor]="getLevelColor(activeLevelRankingTab()) + '20'">
                      <span class="font-bold text-sm" [style.color]="getLevelColor(activeLevelRankingTab())">
                        {{ item.rank }}
                      </span>
                    </div>
                    <div class="font-medium text-gray-900 dark:text-gray-100 text-sm">
                      {{ item.username }}
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="font-bold text-gray-900 dark:text-gray-100">{{ item.value }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">Tests</div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          
          <!-- Tu posici√≥n en este nivel -->
          <div>
            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Tu Posici√≥n en {{ activeLevelRankingTab() }} primero</h4>
            <div class="bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center">
                  <div class="w-10 h-10 rounded-full flex items-center justify-center mr-3"
                      [style.backgroundColor]="getLevelColor(activeLevelRankingTab()) + '30'">
                    <span class="font-bold" [style.color]="getLevelColor(activeLevelRankingTab())">
                      #{{ getMyLevelPosition(activeLevelRankingTab()) || '-' }}
                    </span>
                  </div>
                  <div>
                    <div class="font-medium text-gray-900 dark:text-gray-100">{{ currentUser?.username }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{{ activeLevelRankingTab() }}</div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-bold" [style.color]="getLevelColor(activeLevelRankingTab())">
                    {{ levelStats()?.[activeLevelRankingTab()]?.first_attempt?.tests_count || 0 }} tests
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">
                    {{ getLevelParticipationPercentage(activeLevelRankingTab()).toFixed(1) }}% de tus tests
                  </div>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-3">
                <div class="text-center p-2 bg-white dark:bg-gray-800 rounded">
                  <div class="text-sm font-medium" [style.color]="getLevelColor(activeLevelRankingTab())">
                    {{ levelStats()?.[activeLevelRankingTab()]?.first_attempt?.average_score | number:'1.0-2' }}%
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">Precisi√≥n</div>
                </div>
                <div class="text-center p-2 bg-white dark:bg-gray-800 rounded">
                  <div class="text-sm font-medium" [style.color]="getLevelColor(activeLevelRankingTab())">
                    {{ formatTimeShort(levelStats()?.[activeLevelRankingTab()]?.first_attempt?.average_time_taken_per_question || 0) }}
                  </div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">Tiempo/preg</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    }

    <!-- Acciones R√°pidas -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
      <a routerLink="/tests/not-started"
         class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md dark:hover:shadow-gray-900/30 transition-all text-center group">
        <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mx-auto mb-3 group-hover:bg-blue-200 dark:group-hover:bg-blue-900/50 transition-colors">
          <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"/>
          </svg>
        </div>
        <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-1">Nuevo Test</h4>
        <p class="text-sm text-gray-600 dark:text-gray-400">Realiza un nuevo desaf√≠o</p>
      </a>
      
      <a routerLink="/tests/completed"
         class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md dark:hover:shadow-gray-900/30 transition-all text-center group">
        <div class="w-12 h-12 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg flex items-center justify-center mx-auto mb-3 group-hover:bg-emerald-200 dark:group-hover:bg-emerald-900/50 transition-colors">
          <svg class="w-6 h-6 text-emerald-600 dark:text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
        </div>
        <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-1">Ver Resultados</h4>
        <p class="text-sm text-gray-600 dark:text-gray-400">Revisa tests completados</p>
      </a>
      
      <a routerLink="/tests/in-progress"
         class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md dark:hover:shadow-gray-900/30 transition-all text-center group">
        <div class="w-12 h-12 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center mx-auto mb-3 group-hover:bg-amber-200 dark:group-hover:bg-amber-900/50 transition-colors">
          <svg class="w-6 h-6 text-amber-600 dark:text-amber-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
          </svg>
        </div>
        <h4 class="font-semibold text-gray-900 dark:text-gray-100 mb-1">Continuar Tests</h4>
        <p class="text-sm text-gray-600 dark:text-gray-400">Termina tests en progreso</p>
      </a>
    </div>
  }

  <!-- Error state -->
  @if (error() && !dashboardData()) {
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg dark:shadow-gray-900/30 border border-gray-200 dark:border-gray-700 p-8 text-center">
      <div class="w-20 h-20 text-red-300 dark:text-red-600 mx-auto mb-4">
        <svg fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
        </svg>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">Error al cargar el dashboard</h3>
      <p class="text-gray-500 dark:text-gray-400 max-w-md mx-auto mb-6">
        {{ error() }}
      </p>
      <button (click)="loadDashboardData(true)"
              class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg text-white bg-blue-600 dark:bg-blue-700 hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors">
        Intentar de nuevo
      </button>
    </div>
  }
</div>